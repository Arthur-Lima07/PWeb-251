<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <title>Personagens - Sombras e Caos</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="/stylesheets/personagens.css" rel="stylesheet">
</head>

<body>

  <%- include('partials/navbar') %>

    <div class="background">
      <div class="container py-5 text-white">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h1 class="mb-0">Personagens</h1>

          <form action="/personagens" method="get">
            <select name="ordenar" onchange="this.form.submit()"
              class="form-select w-auto bg-dark text-white border-light">
              <option value="az" <%=ordenacao==='az' ? 'selected' : '' %>>Ordenar: A - Z</option>
              <option value="za" <%=ordenacao==='za' ? 'selected' : '' %>>Ordenar: Z - A</option>
              <option value="recentes" <%=ordenacao==='recentes' ? 'selected' : '' %>>Mais recentes</option>
            </select>
          </form>
        </div>

        <ul class="list-group list-group-flush">
          <% characters.forEach(character=> { %>
            <li class="list-group-item bg-transparent">
              <a href="/personagens/<%= character.name.toLowerCase().replace(/\s+/g, '') %>" class="personagem-link"
                data-name="<%= character.name %>">
                <%= character.name %>
              </a>
            </li>
            <% }) %>
        </ul>
      </div>
    </div>

    <script>
      // Salvando personagens acessados no localStorage
      document.querySelectorAll('.personagem-link').forEach(link => {
        link.addEventListener('click', () => {
          let recent = JSON.parse(localStorage.getItem('recentCharacters')) || [];
          const name = link.dataset.name;

          recent = recent.filter(n => n !== name);
          recent.unshift(name);

          if (recent.length > 10) recent = recent.slice(0, 10);

          localStorage.setItem('recentCharacters', JSON.stringify(recent));
        });
      });
    </script>

    <footer>
      <%- include('partials/footer') %>
    </footer>

</body>

</html>